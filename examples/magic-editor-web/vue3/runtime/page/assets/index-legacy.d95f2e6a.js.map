{"version":3,"file":"index-legacy.d95f2e6a.js","sources":["../../../../../../packages/ui/src/cplot/src/index.vue"],"sourcesContent":["<!-- Test.vue -->\n<template>\n  <div class=\"t-inline-block magic-ui-echart-module\" ref=\"refCplot\" :style=\"style\" />\n</template>\n\n<script lang=\"ts\" setup>\nimport { onMounted, Ref, ref, shallowRef, watch } from 'vue';\nimport * as echarts from 'echarts';\n\nimport { legendInitOption } from '../../commonConfig';\nimport { MCPlot } from '../../types';\nimport useApp from '../../useApp';\nimport useEcharts from '../../useEcharts';\nimport useStyle from '../../useStyle';\nimport { setLegendOption, shouldUpdateCreator } from '../../util';\n\nconst props = defineProps<{\n  config: MCPlot;\n  // model: Object;\n}>();\n\nuseApp(props);\n\nconst refCplot = ref<HTMLElement | null>(null);\nconst refCharts = shallowRef<any>();\n\nconst getChartData = () => {\n  const { dataList, colList, colors } = props.config.dataSourceModel;\n  const { sort, gap, gridTop, gridRight, gridBottom, gridLeft } = props.config;\n  const seriesDataItem: any = {\n    name: colList![1].label,\n    type: 'funnel',\n    top: gridTop,\n    right: gridRight,\n    bottom: gridBottom,\n    left: gridLeft,\n    sort,\n    gap: Number(gap),\n    label: {\n      show: true,\n      position: 'inside',\n    },\n    data: dataList?.map((item, index) => {\n      const [name, value] = item;\n      const itemData: any = {\n        name,\n        value,\n      };\n      const color = colors![index];\n      if (color) {\n        itemData.itemStyle = {\n          color,\n        };\n      }\n      return itemData;\n    }),\n  };\n  const seriesData = [seriesDataItem];\n  return {\n    series: seriesData,\n  };\n};\nconst setChartData = (option: any, getChartData: Function) => {\n  const data = getChartData();\n  option.series = data.series;\n};\n\nonMounted(() => {\n  const { config } = props;\n  const option: echarts.EChartsOption = {\n    legend: [legendInitOption(config)],\n    tooltip: [\n      {\n        show: config.tooltip,\n        trigger: 'item',\n      },\n    ],\n    series: [],\n  };\n  refCharts.value = useEcharts(option, refCplot as Ref<HTMLElement>).value;\n\n  watch(\n    () => props.config,\n    (newVal, oldVal: any = {}) => {\n      const option = refCharts.value?.getOption();\n      const shouldUpdate = shouldUpdateCreator(newVal, oldVal);\n      setLegendOption(shouldUpdate, option, newVal);\n      if (shouldUpdate('tooltip')) {\n        option.tooltip[0].show = newVal.tooltip;\n      }\n\n      setChartData(option, getChartData);\n      refCharts.value.setOption(option);\n    },\n    {\n      immediate: true,\n    },\n  );\n});\n\nconst style = useStyle(props, refCharts);\n</script>\n<style lang=\"scss\" scoped>\n.t-inline-block {\n  display: inline-block;\n}\n</style>\n"],"names":["useApp","props","refCplot","Vue","refCharts","shallowRef","getChartData","dataList","colList","colors","config","dataSourceModel","sort","gap","gridTop","gridRight","gridBottom","gridLeft","seriesDataItem","name","label","type","top","right","bottom","left","Number","show","position","data","map","item","index","value","itemData","color","itemStyle","series","onMounted","option","legend","legendInitOption","tooltip","trigger","useEcharts","watch","newVal","oldVal","option2","getOption","shouldUpdate","shouldUpdateCreator","setLegendOption","setChartData","getChartData2","setOption","immediate","style","useStyle"],"mappings":"ijBAqBAA,EAAAC,GAEA,MAAAC,EAAiBC,cACjBC,EAAkBD,IAAgBE,aAElCC,EAAAA,KACE,MAAAC,SAAAA,EAAAC,QAAAA,EAAAC,OAAAA,GAAAR,EAAAS,OAAAC,iBACAC,KAAAA,EAAAC,IAAAA,EAAAC,QAAAA,EAAAC,UAAAA,EAAAC,WAAAA,EAAAC,SAAAA,GAAAhB,EAAAS,OACAQ,EAAA,CAA4BC,KAAAX,EAAA,GAAAY,MACRC,KAAA,SACZC,IAAAR,EACDS,MAAAR,EACES,OAAAR,EACCS,KAAAR,EACFL,OACNC,IAAAa,OAAAb,GACeO,MAAA,CACRO,MAAA,EACCC,SAAA,UAERC,KAAAtB,GAAAuB,KAAA,CAAAC,EAAAC,KAEE,MAAAb,EAAAc,GAAAF,EACAG,EAAA,CAAsBf,OACpBc,SAGFE,EAAA1B,EAAAuB,GAMA,OALAG,IACED,EAAAE,UAAA,CAAqBD,UAIvBD,CAAA,KAIJ,MAAA,CAAOG,OADP,CAAAnB,GAEU,EAQZf,IAAAmC,WAAA,KACE,MAAA5B,OAAAA,GAAAT,EACAsC,EAAA,CAAsCC,OAAA,CAAAC,EAAA/B,IACHgC,QAAA,CACxB,CACPf,KAAAjB,EAAAgC,QACeC,QAAA,SAGjBN,OAAA,IAGFjC,EAAA6B,MAAAW,EAAAL,EAAArC,GAAA+B,MAEA9B,IAAA0C,OAAA,IAAA5C,EAAAS,SACc,CAAAoC,EAAAC,EAAA,MAEV,MAAAC,EAAA5C,EAAA6B,OAAAgB,YACAC,EAAAC,EAAAL,EAAAC,GACAK,EAAAF,EAAAF,EAAAF,GACAI,EAAA,aACEF,EAAAN,QAAA,GAAAf,KAAAmB,EAAAJ,SA1BRW,EAAAd,EAAAe,KACE,MAAAzB,EAAAyB,IACAf,EAAAF,OAAAR,EAAAQ,MAAA,EA2BIgB,CAAAL,EAAA1C,GACAF,EAAA6B,MAAAsB,UAAAP,EAAA,GACF,CACAQ,WAAA,GAEA,IAIJ,MAAAC,EAAAC,EAAAzD,EAAAG"}