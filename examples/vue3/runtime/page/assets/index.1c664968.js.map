{"version":3,"file":"index.1c664968.js","sources":["../../../../../../packages/ui/src/cplot/src/index.vue"],"sourcesContent":["<!-- Test.vue -->\n<template>\n  <div class=\"t-inline-block magic-ui-echart-module\" ref=\"refCplot\" :style=\"style\" />\n</template>\n\n<script lang=\"ts\" setup>\nimport { onMounted, Ref, ref, shallowRef, watch } from 'vue';\nimport * as echarts from 'echarts';\n\nimport { legendInitOption } from '../../commonConfig';\nimport { MCPlot } from '../../types';\nimport useApp from '../../useApp';\nimport useEcharts from '../../useEcharts';\nimport useStyle from '../../useStyle';\nimport { setLegendOption, shouldUpdateCreator } from '../../util';\n\nconst props = defineProps<{\n  config: MCPlot;\n  // model: Object;\n}>();\n\nuseApp(props);\n\nconst refCplot = ref<HTMLElement | null>(null);\nconst refCharts = shallowRef<any>();\n\nconst getChartData = () => {\n  const { dataList, colList, colors } = props.config.dataSourceModel;\n  const { sort, gap, gridTop, gridRight, gridBottom, gridLeft } = props.config;\n  const seriesDataItem: any = {\n    name: colList![1].label,\n    type: 'funnel',\n    top: gridTop,\n    right: gridRight,\n    bottom: gridBottom,\n    left: gridLeft,\n    sort,\n    gap: Number(gap),\n    label: {\n      show: true,\n      position: 'inside',\n    },\n    data: dataList?.map((item, index) => {\n      const [name, value] = item;\n      const itemData: any = {\n        name,\n        value,\n      };\n      const color = colors![index];\n      if (color) {\n        itemData.itemStyle = {\n          color,\n        };\n      }\n      return itemData;\n    }),\n  };\n  const seriesData = [seriesDataItem];\n  return {\n    series: seriesData,\n  };\n};\nconst setChartData = (option: any, getChartData: Function) => {\n  const data = getChartData();\n  option.series = data.series;\n};\n\nonMounted(() => {\n  const { config } = props;\n  const option: echarts.EChartsOption = {\n    legend: [legendInitOption(config)],\n    tooltip: [\n      {\n        show: config.tooltip,\n        trigger: 'item',\n      },\n    ],\n    series: [],\n  };\n  refCharts.value = useEcharts(option, refCplot as Ref<HTMLElement>).value;\n\n  watch(\n    () => props.config,\n    (newVal, oldVal: any = {}) => {\n      const option = refCharts.value?.getOption();\n      const shouldUpdate = shouldUpdateCreator(newVal, oldVal);\n      setLegendOption(shouldUpdate, option, newVal);\n      if (shouldUpdate('tooltip')) {\n        option.tooltip[0].show = newVal.tooltip;\n      }\n\n      setChartData(option, getChartData);\n      refCharts.value.setOption(option);\n    },\n    {\n      immediate: true,\n    },\n  );\n});\n\nconst style = useStyle(props, refCharts);\n</script>\n<style lang=\"scss\" scoped>\n.t-inline-block {\n  display: inline-block;\n}\n</style>\n"],"names":["useApp","props","refCplot","refCharts","getChartData","dataList","colList","colors","sort","gap","gridTop","gridRight","gridBottom","gridLeft","item","index","name","value","itemData","color","setChartData","option","getChartData2","data","config","legendInitOption","useEcharts","newVal","oldVal","option2","_a","shouldUpdate","shouldUpdateCreator","setLegendOption","style","useStyle"],"mappings":"sUAqBAA,EAAAC,CAAA,EAEA,MAAAC,EAAiB,cACjBC,EAAkB,IAAgB,aAElCC,EAAA,IAAA,CACE,KAAA,CAAA,SAAAC,EAAA,QAAAC,EAAA,OAAAC,CAAA,EAAAN,EAAA,OAAA,gBACA,CAAA,KAAAO,EAAA,IAAAC,EAAA,QAAAC,EAAA,UAAAC,EAAA,WAAAC,EAAA,SAAAC,CAAA,EAAAZ,EAAA,OA8BA,MAAA,CAAO,OADP,CA5BA,CAA4B,KAAAK,EAAA,GAAA,MACR,KAAA,SACZ,IAAAI,EACD,MAAAC,EACE,OAAAC,EACC,KAAAC,EACF,KAAAL,EACN,IAAA,OAAAC,CAAA,EACe,MAAA,CACR,KAAA,GACC,SAAA,QACI,EACZ,KAAAJ,GAAA,YAAAA,EAAA,IAAA,CAAAS,EAAAC,IAAA,CAEE,KAAA,CAAAC,EAAAC,CAAA,EAAAH,EACAI,EAAA,CAAsB,KAAAF,EACpB,MAAAC,CACA,EAEFE,EAAAZ,EAAAQ,GACA,OAAAI,IACED,EAAA,UAAA,CAAqB,MAAAC,CACnB,GAGJD,CAAO,EACR,CAEH,CAEU,CACV,EAEFE,EAAA,CAAAC,EAAAC,IAAA,CACE,MAAAC,EAAAD,IACAD,EAAA,OAAAE,EAAA,MAAqB,EAGvB,IAAA,UAAA,IAAA,CACE,KAAA,CAAA,OAAAC,CAAA,EAAAvB,EACAoB,EAAA,CAAsC,OAAA,CAAAI,EAAAD,CAAA,CAAA,EACH,QAAA,CACxB,CACP,KAAAA,EAAA,QACe,QAAA,MACJ,CACX,EACF,OAAA,CAAA,CACS,EAEXrB,EAAA,MAAAuB,EAAAL,EAAAnB,CAAA,EAAA,MAEA,IAAA,MAAA,IAAAD,EAAA,OACc,CAAA0B,EAAAC,EAAA,KAAA,OAEV,MAAAC,GAAAC,EAAA3B,EAAA,QAAA,YAAA2B,EAAA,YACAC,EAAAC,EAAAL,EAAAC,CAAA,EACAK,EAAAF,EAAAF,EAAAF,CAAA,EACAI,EAAA,SAAA,IACEF,EAAA,QAAA,GAAA,KAAAF,EAAA,SAGFP,EAAAS,EAAAzB,CAAA,EACAD,EAAA,MAAA,UAAA0B,CAAA,CAAgC,EAClC,CACA,UAAA,EACa,CACb,CACF,CAAA,EAGF,MAAAK,EAAAC,EAAAlC,EAAAE,CAAA"}